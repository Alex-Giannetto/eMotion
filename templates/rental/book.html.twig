{% extends 'base.html.twig' %}

{% block body %}
    <div class="container">
        <div class="row">

            <div class="col-12">
                <h1>Valider la réservation</h1>
            </div>

        </div>

        <div class="row bookForm">
            <div>
                <p class="mb-2">Signature</p>
                <div class="text-center">
                    <canvas id="signature-pad" class="signature-pad" width=400 height=200></canvas>
                </div>
            </div>
            <div>
                {{ form_start(form) }}
                {{ form_widget(form) }}


                <br>
                <div class="text-center">
                    <button class="btn btn-outline-primary" id="clear">Effacer</button>
                    <button class="btn btn-primary" id="save-svg">Réserver</button>
                </div>

            </div>

            {{ form_end(form) }}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>

    <script>
      const canvas = document.getElementById('signature-pad')
      const input = document.getElementById('form_signature')

      function resizeCanvas () {
        const ratio = Math.max(window.devicePixelRatio || 1, 1)
        canvas.width = canvas.offsetWidth * ratio
        canvas.height = canvas.offsetHeight * ratio
        canvas.getContext('2d').scale(ratio, ratio)
      }

      window.onresize = resizeCanvas
      resizeCanvas()

      const signaturePad = new SignaturePad(canvas)

      document.getElementById('save-svg').addEventListener('click', function (e) {
        if (signaturePad.isEmpty()) {
          e.preventDefault()
          return alert('Veuillez signer dans l\'encart de gauche.')
        }

        input.setAttribute('value', signaturePad.toDataURL('image/svg+xml'))
      })

      document.getElementById('clear').addEventListener('click', function (e) {
        e.preventDefault()
        signaturePad.clear()
      })


    </script>
{% endblock %}
